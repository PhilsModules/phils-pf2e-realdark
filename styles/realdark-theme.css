/* Phil's PF2e RealDark - CONFIGURABLE EDITION */

:root {
    /* DEFAULT VALUES - Overridden by JS Settings immediately on load */
    --realdark-gold: #ffbd4a;
    --realdark-gold-dim: #b8860b;
    --realdark-text-light: #fff0d4;
    --realdark-red-bright: #ff3333;
    --realdark-input-bg: rgba(0, 0, 0, 0.7);
    --realdark-text-shadow: 0 0 1px black;
    --realdark-banner-color: #7a0000;
    /* AUTO-CALCULATED BY JS */
    /* Sidebar RGBA defaults (roughly 0.8 opacity) */
    --realdark-sidebar-rgba-top: rgba(122, 0, 0, 0.8);
    --realdark-sidebar-rgba-bottom: rgba(0, 0, 0, 0.8);
    /* Image vars are set by JS */
    color-scheme: dark;
    /* Force global dark mode for native controls */
}

/* ======================================================================== */
/* BACKGROUND ASSETS                                                        */
/* ======================================================================== */

/* Main Window Content */
.window-app.realdark-theme-window .window-content {
    background-color: var(--realdark-sheet-bg) !important;
    /* Default: Vignette + Custom Image Override */
    background-image:
        radial-gradient(circle at center, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.1) 60%, rgba(0, 0, 0, 0.6) 100%),
        var(--realdark-bg-url) !important;
    background-repeat: no-repeat, repeat;
    background-size: cover, var(--realdark-bg-size, auto) !important;
    background-position: center !important;
    background-blend-mode: normal !important;
}

/* ======================================================================== */
/* TEXT & CONTRAST                                                          */
/* ======================================================================== */

/* Force COLOR Variables */
.window-app.realdark-theme-window,
.window-app.realdark-theme-window .window-content,
.window-app.realdark-theme-window .window-content * {
    color: var(--realdark-gold) !important;
    text-shadow: var(--realdark-text-shadow) !important;
    color-scheme: dark !important;
    /* Force native controls to dark */
}

/* ...EXCEPT INPUTS */
.window-app.realdark-theme-window input,
.window-app.realdark-theme-window select,
.window-app.realdark-theme-window textarea,
.window-app.realdark-theme-window .prosemirror {
    color: #fff !important;
    text-shadow: none !important;
    background-color: var(--realdark-input-bg) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    box-shadow: none !important;
}

/* Fix Checkboxes & Radio Buttons */
.window-app.realdark-theme-window input[type="checkbox"],
.window-app.realdark-theme-window input[type="radio"] {
    -webkit-appearance: auto !important;
    /* Force standard OS look but dark */
    appearance: auto !important;
    color-scheme: dark !important;
    accent-color: var(--realdark-gold) !important;
    background: transparent !important;
    box-shadow: none !important;
    border: none !important;
}

/* Fix Dropdown Options (Browser dependent, but helps where supported) */
.window-app.realdark-theme-window select option,
.window-app.realdark-theme-window select optgroup {
    background-color: var(--realdark-sheet-bg) !important;
    background: var(--realdark-sheet-bg) !important;
    color: var(--realdark-gold) !important;
}

/* ...AND ICONS */
.window-app.realdark-theme-window i.fas,
.window-app.realdark-theme-window i.far {
    text-shadow: none !important;
}

/* Modifier Highlights */
.window-app.realdark-theme-window .modifier,
.window-app.realdark-theme-window .value,
.window-app.realdark-theme-window .adjusted-value {
    color: var(--realdark-red-bright) !important;
    font-weight: bold;
}

/* Badges - Softened */
.window-app.realdark-theme-window .badge,
.window-app.realdark-theme-window .tag {
    color: #fff !important;
    background: var(--realdark-red-bright) !important;
    border: 1px solid rgba(255, 255, 255, 0.3);
    /* Soft border */
}

/* Chat Buttons - Softened */
html body .chat-message button {
    background: var(--realdark-input-bg) !important;
    color: var(--realdark-gold) !important;
    border: 1px solid rgba(130, 130, 130, 0.2) !important;
    /* Soft border */
    box-shadow: none !important;
}

html body .chat-message button:hover {
    background: var(--realdark-gold-dim) !important;
    color: #000 !important;
    text-shadow: none !important;
    border: 1px solid rgba(255, 255, 255, 0.3) !important;
    /* Glow on hover */
    box-shadow: 0 0 5px rgba(255, 255, 255, 0.3) !important;
}

/* ======================================================================== */
/* CHAT MESSAGE VARIANTS (Whisper, Blind)                                   */
/* ======================================================================== */

/* Styles moved to below generic block to ensure cascade wins */

/* ======================================================================== */
/* CONTEXT MENU FIX                                                         */
/* ======================================================================== */
html body #context-menu {
    background: var(--realdark-sheet-bg) !important;
    color: var(--realdark-gold) !important;
    border: 1px solid var(--realdark-gold-dim) !important;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.8) !important;
    z-index: 9999 !important;
    position: absolute !important;
}

#context-menu .context-items .context-item {
    color: var(--realdark-text-light) !important;
    background: transparent !important;
}

#context-menu .context-items .context-item:hover {
    background: var(--realdark-gold-dim) !important;
    color: #000 !important;
    text-shadow: none !important;
}

/* ======================================================================== */
/* CLEANUP                                                                  */
/* ======================================================================== */

.window-app.realdark-theme-window nav,
.window-app.realdark-theme-window .sheet-navigation,
.window-app.realdark-theme-window .secondary-navigation,
.window-app.realdark-theme-window .actions-nav,
.window-app.realdark-theme-window .spellcasting-nav,
.window-app.realdark-theme-window .sheet-body,
.window-app.realdark-theme-window .sheet-content,
.window-app.realdark-theme-window form,
.window-app.realdark-theme-window .tab,
.window-app.realdark-theme-window .detail-section,
.window-app.realdark-theme-window .actions-options,
.window-app.realdark-theme-window .spellcasting-entry {
    background: transparent !important;
    background-color: transparent !important;
    background-image: none !important;
    box-shadow: none !important;
}

/* Header & Borders - SOFTENED */
.window-app.realdark-theme-window .sheet-header {
    border-bottom: 1px solid rgba(130, 130, 130, 0.2) !important;
    display: flex !important;
    flex-wrap: wrap;
    /* Safety for small widths */
    align-items: flex-end;
    /* Align items to bottom */
    padding-bottom: 0 !important;
}

/* Force Nav to lift items up */
.window-app.realdark-theme-window nav.sheet-navigation {
    margin-bottom: 5px !important;
    /* Larger gap */
    align-items: flex-end !important;
}

.window-app.realdark-theme-window nav.sheet-navigation .item.active {
    border-bottom: 2px solid var(--realdark-gold) !important;
}

.window-app.realdark-theme-window hr {
    border-top: 1px solid rgba(130, 130, 130, 0.2) !important;
    border-bottom: none !important;
}


/* ======================================================================== */
/* CHAT MESSAGES                                                            */
/* ======================================================================== */

/* Target Chat Messages - SOFTENED */
/* Target Chat Messages - SOFTENED */
html body .chat-message {
    background: var(--realdark-sheet-bg) !important;
    background-image: none !important;
    /* backdrop-filter removed to prevent stacking context issues */
    border: 1px solid rgba(130, 130, 130, 0.3) !important;
    /* Soft border */
    color: var(--realdark-gold) !important;
    box-shadow: 0 0 5px #000;
}

/* ======================================================================== */
/* CHAT MESSAGE VARIANTS (Whisper, Blind) - RELOCATED                       */
/* ======================================================================== */

/* Whisper - Blue Border & Subtle Tint */
html body .chat-message.whisper {
    background: rgba(74, 144, 226, 0.1) !important;
    border: 1px solid #4a90e2 !important;
    box-shadow: 0 0 4px rgba(74, 144, 226, 0.4) !important;
}

html body .chat-message.whisper .message-header {
    background-color: rgba(74, 144, 226, 0.1) !important;
    border-bottom-color: #4a90e2 !important;
}

/* Blind - Pink/Magenta Border & Subtle Tint */
html body .chat-message.blind {
    background: rgba(226, 74, 144, 0.1) !important;
    border: 1px solid #e24a90 !important;
    box-shadow: 0 0 4px rgba(226, 74, 144, 0.4) !important;
}

html body .chat-message.blind .message-header {
    background-color: rgba(226, 74, 144, 0.1) !important;
    border-bottom-color: #e24a90 !important;
}

/* Chat Buttons */
html body .chat-message button {
    background: var(--realdark-input-bg) !important;
    color: var(--realdark-gold) !important;
    border: 1px solid rgba(130, 130, 130, 0.2) !important;
    box-shadow: none !important;
}

/* Fix Damage Dialog Text Visibility - Variable Override Strategy */
html body .damage-dialog .damage.instance,
html body .damage-dialog .damage.instance *,
html body .roll-modifiers-dialog .damage.instance,
html body .roll-modifiers-dialog .damage.instance *,
html body .dice-formula .damage.instance,
html body .dice-formula .damage.instance *,
html body .dice-formula span.damage {
    color: #ffffff !important;
    --color: #ffffff !important;
    --text-color: #ffffff !important;
    fill: #ffffff !important;
    -webkit-text-fill-color: #ffffff !important;
    text-shadow: 0 0 2px #000 !important;
    opacity: 1 !important;
}

/* Status/Outcome Text Visibility */
html body .window-app.realdark-theme-window .success,
html body .window-app.realdark-theme-window .outcome.success,
html body .chat-message .success,
html body .chat-message .outcome.success,
html body .chat-message span.success,
html body .chat-message span.degree-of-success .success,
html body .realdark-theme-window .degree-of-success .success {
    color: #6eb4f8 !important;
    /* Brighter Blue */
    text-shadow: 0 0 2px #000;
}

html body .window-app.realdark-theme-window .critical-success,
html body .window-app.realdark-theme-window .outcome.critical-success,
html body .chat-message .critical-success,
html body .chat-message .outcome.critical-success,
html body .chat-message span.critical-success,
html body .chat-message span.degree-of-success .critical-success,
html body .realdark-theme-window .degree-of-success .critical-success {
    color: #6ef886 !important;
    /* Bright Green */
    text-shadow: 0 0 2px #000;
}

html body .window-app.realdark-theme-window .failure,
html body .window-app.realdark-theme-window .outcome.failure,
html body .chat-message .failure,
html body .chat-message .outcome.failure,
html body .chat-message span.failure,
html body .chat-message span.degree-of-success .failure,
html body .realdark-theme-window .degree-of-success .failure {
    color: #f86e6e !important;
    /* Bright Red */
    text-shadow: 0 0 2px #000;
}

html body .window-app.realdark-theme-window .critical-failure,
html body .window-app.realdark-theme-window .outcome.critical-failure,
html body .chat-message .critical-failure,
html body .chat-message .outcome.critical-failure,
html body .chat-message span.critical-failure,
html body .chat-message span.degree-of-success .critical-failure,
html body .realdark-theme-window .degree-of-success .critical-failure {
    color: #ff0000 !important;
    /* Stark Red */
    text-shadow: 0 0 2px #000;
}

/* GM Visibility Text Fix - NO BACKGROUNDS */
html body .window-app.realdark-theme-window [data-visibility="gm"],
html body .chat-message [data-visibility="gm"] {
    color: var(--realdark-text-light) !important;
    background: transparent !important;
    background-color: transparent !important;
    box-shadow: none !important;
    border: none !important;
    text-shadow: 0 0 2px #000;
}

/* Ensure modifier values are visible */
html body .window-app.realdark-theme-window .modifier-container .value,
html body .window-app.realdark-theme-window .modifier-container .mod {
    color: var(--realdark-text-light) !important;
}

html body .chat-message button:hover {
    background: var(--realdark-gold-dim) !important;
    color: #000 !important;
    text-shadow: none !important;
    border: 1px solid rgba(255, 255, 255, 0.3) !important;
    box-shadow: 0 0 5px rgba(255, 255, 255, 0.3) !important;
}

/* Chat Header */
/* Chat Header */
html body .chat-message .message-header {
    color: var(--realdark-gold-dim) !important;
    border-bottom: 1px solid rgba(130, 130, 130, 0.2);
}

html body .chat-message .message-sender {
    color: var(--realdark-gold) !important;
    text-shadow: 0 0 2px black;
}

html body .chat-message .message-metadata {
    color: #888 !important;
}

/* Chat Content & Rolls */
/* Chat Content & Rolls */
html body .chat-message .message-content,
html body .chat-message .card-content {
    color: var(--realdark-text-light) !important;
}

/* Dice Rolls */
/* Dice Rolls */
html body .chat-message .dice-roll .dice-total {
    background: var(--realdark-input-bg) !important;
    color: var(--realdark-gold) !important;
    border: 1px solid rgba(130, 130, 130, 0.2);
    text-shadow: 0 0 5px black;
}

html body .chat-message .dice-roll .dice-formula,
html body .chat-message .dice-roll .dice-tooltip {
    background: var(--realdark-input-bg) !important;
    color: var(--realdark-gold) !important;
    border: 1px solid rgba(130, 130, 130, 0.2);
    text-shadow: none !important;
}

/* Remove flavor backgrounds */
/* Remove flavor backgrounds */
html body .chat-message .flavor-text,
html body .chat-message .tags .tag,
html body .chat-message p span,
html body .chat-message div span[style*="background"] {
    background: transparent !important;
    background-color: transparent !important;
    color: var(--realdark-gold) !important;
    border-color: rgba(130, 130, 130, 0.2) !important;
}

/* Fix Inner Chat Card Headers (Black text issue) */
/* Fix Inner Chat Card Headers (Black text issue) */
html body .chat-message header,
html body .chat-message h3,
html body .chat-message h4,
html body .chat-message .card-header h3 {
    color: var(--realdark-gold) !important;
    text-shadow: 0 0 2px black !important;
}

/* FIX INLINE ROLLS & LINKS (Bright Spots) */
html body .chat-message a.inline-roll,
html body .chat-message a.inline-check,
html body .chat-message a.content-link,
html body .chat-message a.entity-link,
html body .chat-message span.damage-roll,
html body .chat-message button[data-action] {
    background: var(--realdark-input-bg) !important;
    background-color: var(--realdark-input-bg) !important;
    color: var(--realdark-gold) !important;
    border: 1px solid rgba(130, 130, 130, 0.3) !important;
    box-shadow: none !important;
    text-shadow: none !important;
    border-radius: 3px;
    padding: 1px 4px;
}

/* NUCLEAR FIX FOR NESTED SPANS INSIDE INLINE ROLLS */
html body .chat-message a.inline-roll *,
html body .chat-message a.inline-check *,
html body .chat-message a.content-link *,
html body .chat-message a.entity-link *,
html body .chat-message button[data-action] *,
html body .chat-message p span *,
html body .chat-message div span[style*="background"] * {
    background: transparent !important;
    color: inherit !important;
    text-shadow: inherit !important;
    box-shadow: none !important;
}

html body .chat-message a.inline-roll:hover,
html body .chat-message a.inline-check:hover,
html body .chat-message a.content-link:hover,
html body .chat-message a.entity-link:hover,
html body .chat-message button[data-action]:hover {
    background: var(--realdark-gold-dim) !important;
    color: #000 !important;
    text-shadow: none !important;
    border-color: var(--realdark-gold) !important;
}

/* GENERAL WINDOW CONTENT LINKS (Fixing bright fields) */
.window-app.realdark-theme-window a.content-link,
.window-app.realdark-theme-window a.entity-link,
.window-app.realdark-theme-window a.inline-check,
.window-app.realdark-theme-window a.inline-roll,
.window-app.realdark-theme-window span.inline-check,
.window-app.realdark-theme-window span.inline-roll,
.window-app.realdark-theme-window span[data-pf2-check],
.window-app.realdark-theme-window span[data-pf2-saving-throw],
.window-app.realdark-theme-window span[data-pf2-dc],
.window-app.realdark-theme-window [data-visibility="gm"] {
    background: var(--realdark-input-bg) !important;
    color: var(--realdark-gold) !important;
    border: 1px solid rgba(130, 130, 130, 0.3) !important;
    text-shadow: none !important;
    border-radius: 3px;
    padding: 1px 4px;
    text-decoration: none;
}

.window-app.realdark-theme-window a.content-link i,
.window-app.realdark-theme-window a.entity-link i {
    color: var(--realdark-gold) !important;
}

/* ======================================================================== */
/* STUBBORN PF2E SPECIFIC OVERRIDES                                         */
/* ======================================================================== */

/* HARDENING: Attribute Builder & Tag Selectors */
/* These windows often have unique IDs or classes that fight generic styles */
.window-app.realdark-theme-window.attribute-builder .window-content,
.window-app.realdark-theme-window.tag-selector .window-content,
.window-app.realdark-theme-window.damage-dialog .window-content,
.window-app.realdark-theme-window.roll-modifiers-dialog .window-content {
    background: var(--realdark-sheet-bg) !important;
    background-color: var(--realdark-sheet-bg) !important;
    background-image:
        radial-gradient(circle at center, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.1) 60%, rgba(0, 0, 0, 0.6) 100%),
        var(--realdark-bg-url) !important;
    box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
}

/* Force all Sidebar Headers & Labels to Gold */
.window-app.realdark-theme-window .sidebar .health-header,
.window-app.realdark-theme-window .sidebar .defense-header,
.window-app.realdark-theme-window .armor-class .shield-hp,
.window-app.realdark-theme-window .sidebar label,
.window-app.realdark-theme-window .sidebar h4,
.window-app.realdark-theme-window .sidebar span.label {
    color: var(--realdark-gold) !important;
    text-shadow: var(--realdark-text-shadow) !important;
}

/* "MODIFIERS" / Layout Buttons */
.window-app.realdark-theme-window .sidebar a,
.window-app.realdark-theme-window .sidebar button,
.window-app.realdark-theme-window .sidebar .modifier-icon,
.window-app.realdark-theme-window .sidebar .roll-icon {
    background: var(--realdark-input-bg) !important;
    background-color: var(--realdark-input-bg) !important;
    background-image: none !important;
    color: var(--realdark-gold) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    box-shadow: none !important;
}

/* "Untrained" / Proficiency Badges */
.window-app.realdark-theme-window .proficiency-badge,
.window-app.realdark-theme-window .proficiency-rank {
    background: var(--realdark-input-bg) !important;
    background-color: var(--realdark-input-bg) !important;
    color: var(--realdark-red-bright) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    text-shadow: none !important;
}

/* "Edit" / "Toggle" Buttons (Aggressive) */
.window-app.realdark-theme-window a.editor-toggle,
.window-app.realdark-theme-window button.edit-btn,
.window-app.realdark-theme-window a.control,
.window-app.realdark-theme-window .action-button,
.window-app.realdark-theme-window button:not(.rd-submit-btn) {
    background: var(--realdark-input-bg) !important;
    background-color: var(--realdark-input-bg) !important;
    background-image: none !important;
    color: var(--realdark-gold) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    box-shadow: none !important;
}

.window-app.realdark-theme-window a.editor-toggle:hover,
.window-app.realdark-theme-window button.edit-btn:hover,
.window-app.realdark-theme-window button:not(.rd-submit-btn):hover {
    background: var(--realdark-gold-dim) !important;
    border-color: var(--realdark-gold) !important;
    color: #000 !important;
}

/* ======================================================================== */
/* BANNER & SIDEBAR GRADIENTS (THEME CONFIGURABLE)                          */
/* ======================================================================== */

/* Targeted Sidebar Override - Force transparency via variable */
.window-app.realdark-theme-window aside.sidebar,
.window-app.realdark-theme-window .sidebar,
.window-app.realdark-theme-window .sheet-sidebar {
    border-image: none !important;
    border: none !important;
    background-color: transparent !important;
    /* Ensure base is transparent */
    background: linear-gradient(to bottom,
            var(--realdark-sidebar-rgba-top) 0%,
            var(--realdark-sidebar-rgba-bottom) 100%) !important;
    box-shadow: inset 0 0 20px black;
    border-right: 1px solid rgba(130, 130, 130, 0.2) !important;
}

/* Ensure header text sits on top */
/* Ensure header text sits on top */
.window-app.realdark-theme-window .sidebar header,
.window-app.realdark-theme-window aside.sidebar header,
.window-app.realdark-theme-window .crb-style aside header,
.window-app.realdark-theme-window.actor.sheet.character .crb-style aside header {
    background: transparent !important;
    background-image: none !important;
    border-bottom: 1px solid rgba(130, 130, 130, 0.2);
}




/* ======================================================================== */
/* ASSET NEUTRALIZATION & REPLACEMENT                                       */
/* 'The Great Purge' - Replacing Image Assets with CSS                      */
/* ======================================================================== */

/* 1. SHIELDS (AC, HP, ETC) */
/* Targeted removal of shield-red.webp, shield-blue.webp, etc. */
.window-app.realdark-theme-window .armor-class .shield .shield-plate,
.window-app.realdark-theme-window .hit-points .hp-section .hp-value,
.window-app.realdark-theme-window .defense-list .defense .defense-value,
.window-app.realdark-theme-window .pf2e.sheet.character .window-content .sheet-body .sheet-content .tab[data-tab='character'] .health-section .hp-value {
    background-image: none !important;
    background: rgba(0, 0, 0, 0.4) !important;
    border: 2px solid var(--realdark-red-bright) !important;
    border-radius: 8px !important;
    box-shadow: 0 0 10px var(--realdark-red-bright) inset, 0 0 5px #000 !important;
    backdrop-filter: blur(5px);
}

/* Fix text alignment and shape for the new 'Digital Shield' */
.window-app.realdark-theme-window .armor-class .shield .shield-plate {
    width: 100% !important;
    height: 100% !important;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* 2. NAVIGATION TABS */
/* Generic Input Styling - Fix for Dropdowns (Initiative etc) */
.window-app.realdark-theme-window select {
    background: var(--realdark-input-bg) !important;
    color: var(--realdark-gold-dim) !important;
    border: 1px solid rgba(130, 130, 130, 0.4) !important;
    border-radius: 4px;
    color-scheme: dark;
    /* CRITICAL: Forces native dropdown to be dark */
}

.window-app.realdark-theme-window select:hover,
.window-app.realdark-theme-window select:focus {
    color: var(--realdark-gold) !important;
    border: 1px solid var(--realdark-gold) !important;
    box-shadow: 0 0 5px var(--realdark-gold-dim);
}

.window-app.realdark-theme-window select option {
    background-color: #1a1a1a !important;
    color: var(--realdark-gold) !important;
}

/* Removing nav-item.webp and nav-item-inactive.webp */
.window-app.realdark-theme-window .sheet-navigation .item,
.window-app.realdark-theme-window nav.sheet-tabs .item {
    background-image: none !important;
    background: transparent !important;
    border: none !important;
    border-bottom: 3px solid transparent !important;
    /* increased thickness */
    color: var(--realdark-gold-dim) !important;
    transition: all 0.3s ease;
    padding: 9px 10px 1px 10px !important;
    /* Shifted down to center icons */
    transform: translateY(-6px) !important;
    /* Force visual lift */
    position: relative;
    z-index: 5;
}

.window-app.realdark-theme-window .sheet-navigation .item.active,
.window-app.realdark-theme-window nav.sheet-tabs .item.active {
    background-image: none !important;
    border-bottom: 2px solid var(--realdark-gold) !important;
    color: var(--realdark-gold) !important;
    text-shadow: 0 0 8px var(--realdark-gold);
    box-shadow: 0 4px 4px -2px rgba(0, 0, 0, 0.5);
}



.window-app.realdark-theme-window .sheet-navigation .item:hover,
.window-app.realdark-theme-window nav.sheet-tabs .item:hover {
    color: #fff !important;
    text-shadow: 0 0 5px #fff;
}

/* 3. HEADERS & BANNERS */
/* Removing header.webp, banner-bg.webp */
.window-app.realdark-theme-window header .frame,
.window-app.realdark-theme-window .sheet-header,
.window-app.realdark-theme-window .summary-header,
.window-app.realdark-theme-window .tab[data-tab='actions'] .actions-container .actions-header {
    background-image: none !important;
    background: linear-gradient(90deg, transparent, rgba(0, 0, 0, 0.6), transparent) !important;
    border-bottom: 1px solid var(--realdark-gold-dim) !important;
}

/* 4. DECORATIONS */
/* Hiding miscellaneous textures clearly */
.window-app.realdark-theme-window .sidebar_top,
.window-app.realdark-theme-window .sidebar_bottom,
.window-app.realdark-theme-window .accent-decoration,
.window-app.realdark-theme-window .corner-box,
.window-app.realdark-theme-window [src*='accent-decoration.webp'],
.window-app.realdark-theme-window [src*='corner-box.webp'],
.window-app.realdark-theme-window [style*='corner-box.webp'] {
    display: none !important;
}

/* 5. SIDEBAR CLEANUP - SUPER SPECIFIC TARGETING */
.window-app.realdark-theme-window .sidebar::before,
.window-app.realdark-theme-window .sidebar::after,
.window-app.realdark-theme-window aside.sidebar::before,
.window-app.realdark-theme-window aside.sidebar::after,
.window-app.realdark-theme-window .crb-style aside::before,
.window-app.realdark-theme-window .crb-style aside::after,
.window-app.realdark-theme-window form.crb-style aside::before,
.window-app.realdark-theme-window form.crb-style aside::after,
.window-app.realdark-theme-window .crb-style .sidebar::before,
.window-app.realdark-theme-window .crb-style .sidebar::after,
/* Target Specific System Path (0,6,1 vs 0,5,2) */
.window-app.realdark-theme-window.actor.sheet.character .crb-style aside,
.window-app.realdark-theme-window.actor.sheet.character .crb-style .sidebar {
    background-image: none !important;
    background: transparent !important;
    border-image: none !important;
    /* CORRECTED: Do NOT hide the element, just the background */
}

/* 6. INPUT UNDERLINES */
/* Remove the 'stroke.svg' underlines if they exist as images */
/* 6. INPUT UNDERLINES */
/* Remove the 'stroke.svg' underlines if they exist as images */
.window-app.realdark-theme-window input {
    background-image: none !important;
}

/* 7. LOGO REPLACEMENT */
/* Swap Pathfinder Logo with Custom Module Logo */
/* Swap Pathfinder Logo with Custom Module Logo */
.window-app.realdark-theme-window .sheet-header .logo:not(.realdark-logo),
.window-app.realdark-theme-window header .logo:not(.realdark-logo),
.window-app.realdark-theme-window header img[src*="Pathfinder"]:not(.realdark-logo),
.window-app.realdark-theme-window header img[src*="logo"]:not(.realdark-logo) {
    display: none !important;
    opacity: 0 !important;
    visibility: hidden !important;
    width: 0 !important;
    height: 0 !important;
    pointer-events: none !important;
}

.realdark-logo {
    display: block !important;
    opacity: 1 !important;
    visibility: visible !important;
    /* Allow JS to control dimensions */
    width: auto;
    height: auto;
    z-index: 100 !important;
    position: relative !important;
    pointer-events: all !important;
    margin-top: 2px !important;
    /* Nudge down slighty */
}

/* Ensure Charname image is NOT hidden if it was caught before (likely token art) */
/* Ensure Charname image is NOT hidden if it was caught before (likely token art) */
.window-app.realdark-theme-window .charname img {
    display: block !important;
    opacity: 1 !important;
    visibility: visible !important;
    width: auto !important;
    height: auto !important;
}

/* Fix for standard Logo container gap in Sidebar */
.window-app.realdark-theme-window .sidebar .logo,
.window-app.realdark-theme-window aside .logo {
    margin-top: 0 !important;
    padding-top: 0 !important;
    position: relative;
    background: transparent !important;
    border: none !important;
}

/* Removed aggressive sidebar image hiding */

/* Targeted Background Elements that might be masquerading as content */
/* Targeted Background Elements that might be masquerading as content */
.window-app.realdark-theme-window .sidebar_top,
.window-app.realdark-theme-window .sidebar_bottom,
.window-app.realdark-theme-window .sheet-sidebar .sidebar_top,
.window-app.realdark-theme-window .sheet-sidebar .sidebar_bottom,
.window-app.realdark-theme-window aside.sidebar .sidebar_top,
.window-app.realdark-theme-window aside.sidebar .sidebar_bottom,
.window-app.realdark-theme-window [style*="red_sidebar"] {
    display: none !important;
    background: none !important;
    width: 0 !important;
    height: 0 !important;
    opacity: 0 !important;
    pointer-events: none !important;
}

/* Ensure Logo Area Collapse */
/* Ensure Logo Area Collapse */
.window-app.realdark-theme-window header h1 {
    background: transparent !important;
}

.window-app.realdark-theme-window .charname {
    margin: 0 !important;
}

/* ======================================================================== */
/* TARGETED ASSET NULLIFICATION (USER LIST)                                 */
/* Explicitly catching every file requested by user                         */
/* ======================================================================== */

/* 1. Sidebar & Backgrounds */
.window-app.realdark-theme-window [src*='blue_sidebar_top.webp'],
.window-app.realdark-theme-window [style*='blue_sidebar_top.webp'],
.window-app.realdark-theme-window [src*='blue_sidebar_bottom.webp'],
.window-app.realdark-theme-window [style*='blue_sidebar_bottom.webp'],
.window-app.realdark-theme-window [src*='banner-bg.webp'],
.window-app.realdark-theme-window [style*='banner-bg.webp'],
.window-app.realdark-theme-window [src*='banner-bg2.webp'],
.window-app.realdark-theme-window [style*='banner-bg2.webp'],
.window-app.realdark-theme-window [src*='background.webp'],
.window-app.realdark-theme-window [style*='background.webp'],
.window-app.realdark-theme-window [src*='parchment.webp'],
.window-app.realdark-theme-window [style*='parchment.webp'],
.window-app.realdark-theme-window [src*='red_sidebar'],
.window-app.realdark-theme-window [style*='red_sidebar'] {
    display: none !important;
    background-image: none !important;
    visibility: hidden !important;
    width: 0 !important;
    height: 0 !important;
}

/* 2. Headers & Decorations */
.window-app.realdark-theme-window [src*='accent-decoration.webp'],
.window-app.realdark-theme-window [style*='accent-decoration.webp'],
.window-app.realdark-theme-window [src*='header.webp'],
.window-app.realdark-theme-window [style*='header.webp'],
.window-app.realdark-theme-window [src*='header-bw.webp'],
.window-app.realdark-theme-window [style*='header-bw.webp'],
.window-app.realdark-theme-window [src*='gold.webp'],
.window-app.realdark-theme-window [style*='gold.webp'],
.window-app.realdark-theme-window [src*='frame-elegant.svg'],
.window-app.realdark-theme-window [style*='frame-elegant.svg'],
.window-app.realdark-theme-window [src*='deity.svg'],
.window-app.realdark-theme-window [style*='deity.svg'],
.window-app.realdark-theme-window [src*='deity.webp'],
.window-app.realdark-theme-window [style*='deity.webp'],
.window-app.realdark-theme-window [src*='corner-box.webp'],
.window-app.realdark-theme-window [style*='corner-box.webp'],
.window-app.realdark-theme-window [src*='corner-box.svg'],
.window-app.realdark-theme-window [style*='corner-box.svg'],
.window-app.realdark-theme-window [src*='border-pattern.webp'],
.window-app.realdark-theme-window [style*='border-pattern.webp'] {
    display: none !important;
    background-image: none !important;
}

/* 3. Navigation & Badges */
.window-app.realdark-theme-window [src*='nav-item.webp'],
.window-app.realdark-theme-window [style*='nav-item.webp'],
.window-app.realdark-theme-window [src*='nav-item-inactive.webp'],
.window-app.realdark-theme-window [style*='nav-item-inactive.webp'],
.window-app.realdark-theme-window [src*='level-badge.webp'],
.window-app.realdark-theme-window [style*='level-badge.webp'] {
    display: none !important;
    background-image: none !important;
}

/* 4. Item Frames */
.window-app.realdark-theme-window [src*='item-frame.svg'],
.window-app.realdark-theme-window [style*='item-frame.svg'] {
    /* We often want to KEEP the item frame but remove the image */
    /* So we hide duplicate images but force CSS borders on containers instead */
    display: none !important;
}

/* ======================================================================== */
/* 5. SIDEBAR CLEANUP - SUPER SPECIFIC TARGETING                            */
/* ======================================================================== */

/* Remove standard pseudo-elements and potential images */
.window-app.realdark-theme-window .sidebar::before,
.window-app.realdark-theme-window .sidebar::after,
.window-app.realdark-theme-window aside.sidebar::before,
.window-app.realdark-theme-window aside.sidebar::after,
.window-app.realdark-theme-window .crb-style aside::before,
.window-app.realdark-theme-window .crb-style aside::after,
.window-app.realdark-theme-window form.crb-style aside::before,
.window-app.realdark-theme-window form.crb-style aside::after,
.window-app.realdark-theme-window .crb-style .sidebar::before,
.window-app.realdark-theme-window .crb-style .sidebar::after {
    background-image: none !important;
    content: none !important;
    display: none !important;
}

/* CORRECTED: Don't hide the sidebar itself, just the background! */
.window-app.realdark-theme-window.actor.sheet.character .crb-style aside,
.window-app.realdark-theme-window.actor.sheet.character .crb-style .sidebar {
    background-image: none !important;
    background: transparent !important;
    border-image: none !important;
    /* Do NOT set display:none here! */
}

/* Removed aggressive sidebar image hiding */

.window-app.realdark-theme-window aside {
    background-color: transparent !important;
}

/* ======================================================================== */
/* 6. REINSTATEMENT & ATMOSPHERE (THE FINAL LAYER)                          */
/* ======================================================================== */

/* Common Selector base for Re-instatement - beats System (0,5,2) with (0,6,1) */
.window-app.realdark-theme-window aside.sidebar,
.window-app.realdark-theme-window .sidebar,
.window-app.realdark-theme-window .sheet-sidebar,
.window-app.realdark-theme-window .crb-style aside,
.window-app.realdark-theme-window .crb-style .sidebar,
.window-app.realdark-theme-window.actor.sheet.character .crb-style aside {
    background: linear-gradient(to bottom, var(--realdark-sidebar-rgba-top) 0%, var(--realdark-sidebar-rgba-bottom) 100%) !important;
    background-image: linear-gradient(to bottom, var(--realdark-sidebar-rgba-top) 0%, var(--realdark-sidebar-rgba-bottom) 100%) !important;
    background-color: transparent !important;
    border-image: none !important;
    box-shadow: inset 0 0 20px black;
    /* Reset props that system sets */
    background-repeat: no-repeat !important;
    background-size: 100% 100% !important;
}

/* Force children to verify they are clean */
.window-app.realdark-theme-window .sheet-sidebar *,
.window-app.realdark-theme-window .crb-style aside *,
.window-app.realdark-theme-window .crb-style .sidebar * {
    background-image: none !important;
    background-color: transparent !important;
    border-image: none !important;
    box-shadow: none !important;
}

/* SCORCHED EARTH: Top Sidebar Subsections & Pseudo-elements */
/* UNIVERSAL TARGETING: All direct children AND grandchildren of the sidebar */
/* UNIVERSAL TARGETING: All direct children AND grandchildren of the sidebar */
.window-app.realdark-theme-window aside>*,
.window-app.realdark-theme-window .crb-style aside>*,
.window-app.realdark-theme-window .sidebar>*,
.window-app.realdark-theme-window .crb-style .sidebar>*,
/* Pseudos for children */
.window-app.realdark-theme-window .crb-style aside>*::before,
.window-app.realdark-theme-window .crb-style aside>*::after,
.window-app.realdark-theme-window .crb-style .sidebar>*::before,
.window-app.realdark-theme-window .crb-style .sidebar>*::after {
    background: transparent !important;
    background-image: none !important;
    box-shadow: none !important;
    border: none !important;
    content: none !important;
}

/* DEEP VOIDS: Specific Subsections (HP, AC, Perception) */
/* Target the container, its pseudo-elements, AND ALL CHILDREN recursively */
.window-app.realdark-theme-window .hitpoints,
.window-app.realdark-theme-window .hitpoints *,
.window-app.realdark-theme-window .hitpoints::before,
.window-app.realdark-theme-window .hitpoints::after,
.window-app.realdark-theme-window .hitpoints *::before,
.window-app.realdark-theme-window .hitpoints *::after,

.window-app.realdark-theme-window .armor-class,
.window-app.realdark-theme-window .armor-class *,
.window-app.realdark-theme-window .armor-class::before,
.window-app.realdark-theme-window .armor-class::after,
.window-app.realdark-theme-window .armor-class *::before,
.window-app.realdark-theme-window .armor-class *::after,

.window-app.realdark-theme-window .perception,
.window-app.realdark-theme-window .perception *,
.window-app.realdark-theme-window .perception::before,
.window-app.realdark-theme-window .perception::after,
.window-app.realdark-theme-window .perception *::before,
.window-app.realdark-theme-window .perception *::after {
    background: transparent !important;
    background-image: none !important;
    box-shadow: none !important;
    border: none !important;
    /* Don't set content:none here or we lose text */
}

/* EXCEPT those we specifically styled (Inputs/Buttons) */
.window-app.realdark-theme-window aside.sidebar input,
.window-app.realdark-theme-window aside.sidebar button,
.window-app.realdark-theme-window .sidebar input,
.window-app.realdark-theme-window .sidebar button,
.window-app.realdark-theme-window .crb-style aside input,
.window-app.realdark-theme-window .crb-style aside button {
    background-color: var(--realdark-input-bg) !important;
    box-shadow: none !important;
}

/* Ensure Logo Area Collapse */
header h1 {
    background: transparent !important;
}

.charname {
    margin: 0 !important;
}


/* 5. SIDEBAR BACKGROUND RESET                                              */
/* ======================================================================== */
/* Force the container to hold the gradient */
.window-app.realdark-theme-window aside.sidebar,
.window-app.realdark-theme-window .sidebar,
.window-app.realdark-theme-window .sheet-sidebar {
    background: linear-gradient(to bottom, var(--realdark-banner-color) 0%, #000 100%) !important;
    background-image: linear-gradient(to bottom, var(--realdark-banner-color) 0%, #000 100%) !important;
    background-color: transparent !important;
    border-image: none !important;
    box-shadow: inset 0 0 20px black;
}

/* Force ALL children to be transparent so they don't block the gradient */
.window-app.realdark-theme-window aside.sidebar *,
.window-app.realdark-theme-window .sidebar *,
.window-app.realdark-theme-window .sheet-sidebar *,
.window-app.realdark-theme-window .crb-style aside *,
.window-app.realdark-theme-window .crb-style .sidebar * {

    background-image: none !important;
    background-color: transparent !important;
    border-image: none !important;
    box-shadow: none !important;
}

/* EXCEPT those we specifically styled (Inputs/Buttons) */
.window-app.realdark-theme-window aside.sidebar input,
.window-app.realdark-theme-window aside.sidebar button,
.window-app.realdark-theme-window .sidebar input,
.window-app.realdark-theme-window .sidebar button,
.window-app.realdark-theme-window .crb-style aside input,
.window-app.realdark-theme-window .crb-style aside button {
    background-color: var(--realdark-input-bg) !important;
    box-shadow: none !important;
    /* Re-apply locally if needed */
}

/* Re-assert Background Colors where images were removed */
.sidebar,
.sheet-sidebar,
.window-app.realdark-theme-window aside {
    background-color: transparent !important;
}

/* ======================================================================== */
/* 7. HIGH SPECIFICITY OVERRIDES                                            */
/* ======================================================================== */
/* 
   If this doesn't work, nothing will.
   We use 'html body' to artificially boost specificity above any system level.
   We target every standard container tag inside the sidebar.
*/

html body .window-app.realdark-theme-window .crb-style aside div,

/* ======================================================================== */
/* 8. PF2E REMASTER TABLES                                                  */
/* ======================================================================== */

.window-app.realdark-theme-window table.pf2e.remaster,
.window-app.realdark-theme-window table.pf2e.remaster thead,
.window-app.realdark-theme-window table.pf2e.remaster tbody,
.window-app.realdark-theme-window table.pf2e.remaster tr,
.window-app.realdark-theme-window table.pf2e.remaster th,
.window-app.realdark-theme-window table.pf2e.remaster td {
    background: transparent !important;
    background-color: transparent !important;
    color: var(--realdark-text-light) !important;
    border-color: rgba(130, 130, 130, 0.2) !important;
}

/* Fix alternating rows or distinct headers if needed */
.window-app.realdark-theme-window table.pf2e.remaster th {
    background: rgba(0, 0, 0, 0.4) !important;
    color: var(--realdark-gold) !important;
}

.window-app.realdark-theme-window table.pf2e.remaster tbody tr:nth-child(odd) {
    background: rgba(255, 255, 255, 0.05) !important;
}

.window-app.realdark-theme-window table.pf2e.remaster tbody tr:nth-child(even) {
    background: rgba(0, 0, 0, 0.2) !important;
}

/* Fix strong/bold text inside tables */
.window-app.realdark-theme-window table.pf2e.remaster strong,

/* ======================================================================== */
/* 9. INVENTORY HEADER & CURRENCY FIXES                                     */
/* ======================================================================== */

/* Currency / Coinage Container */
.window-app.realdark-theme-window .coinage,
.window-app.realdark-theme-window .coinage .currency,
.window-app.realdark-theme-window .coinage .wealth {
    background: var(--realdark-input-bg) !important;
    background-color: var(--realdark-input-bg) !important;
    color: var(--realdark-gold) !important;
    border: 1px solid rgba(130, 130, 130, 0.2) !important;
    box-shadow: none !important;
}

/* Wealth Breakdown lines */
.window-app.realdark-theme-window .coinage .wealth .item-name {
    color: var(--realdark-gold-dim) !important;
}

.window-app.realdark-theme-window .coinage .wealth .item-name span {
    color: var(--realdark-text-light) !important;
}

/* Encumbrance & Resonance Bars */
.window-app.realdark-theme-window .encumbrance,
.window-app.realdark-theme-window .encumbrance .encumbrance-bar,
.window-app.realdark-theme-window .invested-total {
    background: var(--realdark-input-bg) !important;
    color: var(--realdark-gold) !important;
    border: 1px solid rgba(130, 130, 130, 0.2) !important;
}

.window-app.realdark-theme-window .encumbrance .bar,
.window-app.realdark-theme-window .invested-total .bar {
    background-color: var(--realdark-gold-dim) !important;
}

/* Fix specific list items in currency */
.window-app.realdark-theme-window .coinage li,
.window-app.realdark-theme-window .coinage li.label {
    color: var(--realdark-gold) !important;
    border-color: rgba(130, 130, 130, 0.2) !important;
}


html body .window-app.realdark-theme-window .crb-style aside header,
html body .window-app.realdark-theme-window .crb-style aside nav,

/* ======================================================================== */
/* 10. SPELLCASTING DIALOG FIX                                              */
/* ======================================================================== */

#spellcasting-dialog .window-content,
#spellcasting-dialog form {
    background: var(--realdark-sheet-bg) !important;
    color: var(--realdark-gold) !important;
}

#spellcasting-dialog .form-group label {
    color: var(--realdark-gold) !important;
}

#spellcasting-dialog select {
    background: var(--realdark-input-bg) !important;
    color: #fff !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
}

#spellcasting-dialog select option {
    background: var(--realdark-sheet-bg) !important;
    color: var(--realdark-gold) !important;
}

#spellcasting-dialog button {
    background: rgba(0, 0, 0, 0.5) !important;
    color: var(--realdark-gold) !important;
    border: 1px solid var(--realdark-gold-dim) !important;
}

#spellcasting-dialog button:hover {
    box-shadow: 0 0 5px var(--realdark-gold) !important;
}

/* Ensure the wrapper also loses the light theme background if applied */
#spellcasting-dialog.theme-light {
    background-image: none !important;
    background: var(--realdark-sheet-bg) !important;
}


/* ======================================================================== */
/* 11. IWR (IMMUNITIES/WEAKNESSES/RESISTANCES) EDITOR FIX                   */
/* ======================================================================== */

.window-app.iwr-editor .window-content,
.window-app.iwr-editor form {
    background: var(--realdark-sheet-bg) !important;
    color: var(--realdark-gold) !important;
}

.window-app.iwr-editor h2,
.window-app.iwr-editor label {
    color: var(--realdark-gold) !important;
    border-bottom-color: rgba(130, 130, 130, 0.3) !important;
}

/* Inputs & Selects in IWR */
.window-app.iwr-editor input,
.window-app.iwr-editor select,
.window-app.iwr-editor .tagify {
    background: var(--realdark-input-bg) !important;
    color: #fff !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
}

.window-app.iwr-editor select option {
    background: var(--realdark-sheet-bg) !important;
    color: var(--realdark-gold) !important;
}

/* Tagify styling specific adjustments */
.window-app.iwr-editor .tagify tag {
    background: var(--realdark-gold-dim) !important;
    color: #fff !important;
}

.window-app.iwr-editor .tagify tag x {
    color: #fff !important;
}

/* ======================================================================== */
/* 11. GLOBAL TAGIFY & INPUT FIX (Crucial for Item Sheets)                  */
/* ======================================================================== */

/* Force Tagify containers to be dark */
html body .window-app.realdark-theme-window .tagify,
html body .window-app.realdark-theme-window .tagify.tagify--focus,
html body .window-app.realdark-theme-window tag,
html body .window-app.realdark-theme-window .tagify__input {
    background: var(--realdark-input-bg) !important;
    background-color: var(--realdark-input-bg) !important;
    color: var(--realdark-text-light) !important;
    border-color: rgba(255, 255, 255, 0.2) !important;
    --tags-border-color: rgba(255, 255, 255, 0.2) !important;
    --tag-bg: var(--realdark-gold-dim) !important;
    --tag-text-color: #fff !important;
    --tag-remove-btn-color: #fff !important;
}

/* Fix the actual text input area inside Tagify */
html body .window-app.realdark-theme-window .tagify__input::before {
    color: var(--realdark-text-light) !important;
    /* Placeholder text */
    opacity: 0.7;
}

/* Individual Tags */
html body .window-app.realdark-theme-window tag.tagify__tag>div,
html body .window-app.realdark-theme-window .tagify__tag>div {
    background-color: var(--realdark-gold-dim) !important;
    color: #fff !important;
    border-radius: 3px;
}

html body .window-app.realdark-theme-window .tagify__tag__removeBtn {
    color: #fff !important;
}

html body .window-app.realdark-theme-window .tagify__tag__removeBtn:hover {
    background: var(--realdark-red-bright) !important;
    color: white !important;
}

/* General Catch-All for any stubborn Inputs/Textareas */
html body .window-app.realdark-theme-window input[type="text"],
html body .window-app.realdark-theme-window input[type="number"],
html body .window-app.realdark-theme-window textarea,
html body .window-app.realdark-theme-window select {
    background-color: var(--realdark-input-bg) !important;
    color: var(--realdark-text-light) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    color-scheme: dark !important;
}

html body .window-app.realdark-theme-window select option {
    background-color: #050505 !important;
    color: var(--realdark-gold) !important;
}

/* Aggressive Select Fix for generic system fields */
html body .window-app.realdark-theme-window select {
    -webkit-appearance: none !important;
    appearance: none !important;
    background-image: none !important;
}

html body .window-app.realdark-theme-window input::placeholder,
html body .window-app.realdark-theme-window textarea::placeholder {
    color: rgba(255, 255, 255, 0.5) !important;
}

/* Previous IWR Specifics (Retained but redundant now) */
.window-app.realdark-theme-window .window-app.iwr-editor button,
.window-app.realdark-theme-window .window-app.iwr-editor .form-action {
    color: var(--realdark-gold) !important;

}

/* Override light theme wrapper */
.window-app.realdark-theme-window .window-app.iwr-editor.theme-light,
.window-app.realdark-theme-window.iwr-editor.theme-light {
    background-image: none !important;
    background: var(--realdark-sheet-bg) !important;
}

/* ======================================================================== */
/* 12. INITIATIVE SELECTOR FIX                                              */
/* ======================================================================== */

/* RE-NUKE INITIATIVE FIX - FINAL ATTEMPT */
/* Targeting specifically with opaque background to force rendering engine compliance */
html body select[name="system.initiative.statistic"],
html body .window-app.realdark-theme-window select[name="system.initiative.statistic"] {
    background-color: #050505 !important;
    color: var(--realdark-gold) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    color-scheme: dark !important;
}

html body select[name="system.initiative.statistic"] option,
html body .window-app.realdark-theme-window select[name="system.initiative.statistic"] option {
    background-color: #050505 !important;
    color: var(--realdark-gold) !important;
    -webkit-appearance: none !important;
    appearance: none !important;
}


html body .window-app.realdark-theme-window .crb-style aside h1,
html body .window-app.realdark-theme-window .crb-style aside h2,
html body .window-app.realdark-theme-window .crb-style aside h3,
html body .window-app.realdark-theme-window .crb-style aside .sidebar div,
html body .window-app.realdark-theme-window .crb-style aside .sidebar section,
html body .window-app.realdark-theme-window .crb-style aside .sidebar header,
html body .window-app.realdark-theme-window .crb-style aside .sidebar h2 {
    background: transparent !important;
    background-image: none !important;
    box-shadow: none !important;
    border-color: transparent !important;
}

/* Re-Re-Protect Inputs & Buttons from the nuclear blast */
/* Re-Re-Protect Inputs & Buttons from the nuclear blast - SOFTENED */
html body .window-app.realdark-theme-window .crb-style aside input,
html body .window-app.realdark-theme-window .crb-style aside button,
html body .window-app.realdark-theme-window .crb-style aside select,
html body .window-app.realdark-theme-window .crb-style aside textarea {
    background-color: rgba(0, 0, 0, 0.5) !important;
    /* Darker, slightly transparent */
    border: 1px solid rgba(130, 130, 130, 0.4) !important;
    /* Subtle grey/transparent border */
    box-shadow: none !important;
    color: var(--realdark-text-light) !important;
    transition: border-color 0.2s ease;
}

html body .window-app.realdark-theme-window .crb-style aside input:hover,
html body .window-app.realdark-theme-window .crb-style aside button:hover,
html body .window-app.realdark-theme-window .crb-style aside select:hover,
html body .window-app.realdark-theme-window .crb-style aside textarea:hover {
    border: 1px solid rgba(255, 255, 255, 0.3) !important;
    /* Glow on hover only */
}


/* ======================================================================== */
/* 8. WINDOW HEADER CONTROLS (Manual Polish)                                */
/* ======================================================================== */

/* Remove the 'box' look from header buttons (Token, Configure, Close) */
.window-app.realdark-theme-window .window-header .window-control,
.window-app.realdark-theme-window .window-header a {
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
    color: var(--realdark-gold) !important;
    /* Brighter gold */
    opacity: 1 !important;
    /* maximum visibility */
    text-shadow: 0 0 2px black;
    /* clearer contrast */
    transition: all 0.2s ease;
}

/* Hover State: Brighten up and maybe subtle glow */
.window-app.realdark-theme-window .window-header .window-control:hover,
.window-app.realdark-theme-window .window-header a:hover {
    background: transparent !important;
    color: #fff !important;
    /* White on hover for max pop */
    text-shadow: 0 0 5px var(--realdark-gold);
    cursor: pointer;
}

/* Clean up the title text as well */
.window-app.realdark-theme-window .window-header .window-title {
    text-align: left;
    /* User prefers left alignment */
    flex: 1;
    /* Ensure it takes up space to push buttons right */
    color: var(--realdark-gold) !important;
    text-shadow: var(--realdark-text-shadow) !important;
    font-weight: bold;
    border: none !important;
}

/* ======================================================================== */
/* 9. REINFORCEMENTS (Wrap Up)                                              */
/* ======================================================================== */

/* Ensure the Main Sheet Background Color is always respected, even against vignettes */
html body .window-app.realdark-theme-window .window-content {
    background-color: var(--realdark-sheet-bg) !important;
}

/* Ensure the Sidebar takes the gradient defined by JS (via variable) */
/* This is just a CSS backup for the JS inline style */
html body .window-app.realdark-theme-window aside.sidebar,
html body .window-app.realdark-theme-window .sidebar,
html body .window-app.realdark-theme-window .sheet-sidebar {
    background-image: linear-gradient(to bottom, var(--realdark-banner-color) 0%, #000 100%) !important;
}


/* ======================================================================== */
/* 10. UNIFIED ATMOSPHERE SYSTEM 2.0 (The Real Fix)                         */
/* ======================================================================== */

/* 1. Base Container Setup */
.window-app.realdark-theme-window .window-content {
    position: relative;
    /* Ensure it catches absolute children */
    z-index: 0;
    overflow: hidden !important;
    /* Keep atmosphere inside */
    /* Ensure background color is consistent but we will layer on top */
    background-color: var(--realdark-sheet-bg) !important;
}

/* 2. The Atmosphere Layer (Global Overlay) */
.window-app.realdark-theme-window .window-content::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
    /* Sit BEHIND content */
    pointer-events: none;
    opacity: 0.5;
    /* Restore intensity */
    mix-blend-mode: screen;
    /* Lighten the dark background */
    transition: opacity 2s ease;
}

/* 2.5 Ensure Content Sits ON TOP of Atmosphere */
.window-app.realdark-theme-window .window-content>*,
.window-app.realdark-theme-window .window-content form,
.window-app.realdark-theme-window .window-content .sheet-body {
    position: relative !important;
    z-index: auto !important;
    /* Let natural stacking handle it (Relative > Absolute) */
}

/* 3. Make Sidebar Glassy */
/* Replaces opaque gradients with semi-transparent ones */
.window-app.realdark-theme-window aside.sidebar,
.window-app.realdark-theme-window .sidebar,
.window-app.realdark-theme-window .sheet-sidebar {
    /* Tint color from variable, but semi-transparent */
    /* Fallback for older browsers: just opacity */
    background: linear-gradient(to bottom, var(--realdark-banner-color), black) !important;
    /* Modern CSS: color-mix for true transparency */
    background: linear-gradient(to bottom, color-mix(in srgb, var(--realdark-banner-color) 80%, transparent), color-mix(in srgb, black 90%, transparent)) !important;

    box-shadow: 2px 0 10px rgba(0, 0, 0, 0.5);
    /* subtle separation */
    border-right: 1px solid var(--realdark-gold-dim) !important;

    /* Ensure no other images interfere */
    background-image: linear-gradient(to bottom, color-mix(in srgb, var(--realdark-banner-color) 80%, transparent), color-mix(in srgb, black 90%, transparent)) !important;
}

/* Ensure sidebar children don't paint backgrounds */
.window-app.realdark-theme-window aside.sidebar *,
.window-app.realdark-theme-window .sidebar * {
    background-color: transparent !important;
}

/* Restore inputs */
.window-app.realdark-theme-window aside.sidebar input,
.window-app.realdark-theme-window .sidebar input,
.window-app.realdark-theme-window aside.sidebar button,
.window-app.realdark-theme-window .sidebar button {
    background-color: var(--realdark-input-bg) !important;
}


/* 4. Implement Modes on ::before */

/* FOG (Global) */
:root[data-realdark-atmosphere="fog"] .window-app.realdark-theme-window .window-content::before {
    background-image:
        radial-gradient(circle at 20% 50%, var(--realdark-banner-color) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(100, 100, 100, 0.3) 0%, transparent 50%);
    background-size: 150% 150%;
    /* Larger canvas for movement */
    filter: blur(40px);
    opacity: 0.5;
    /* animation: realdark-fog-pulse 20s infinite alternate; */
}

/* VEINS (New Design - Organic Web) */
:root[data-realdark-atmosphere="veins"] .window-app.realdark-theme-window .window-content::before {
    /* Complex intersecting radial patterns to simulate organic webbing/veins */
    background-image:
        repeating-radial-gradient(circle at 0 0, transparent 0, rgba(255, 255, 255, 0.08) 1px, transparent 2px, transparent 15px),
        repeating-radial-gradient(circle at 100% 0, transparent 0, rgba(255, 255, 255, 0.08) 1px, transparent 2px, transparent 15px),
        repeating-radial-gradient(circle at 50% 100%, transparent 0, rgba(255, 255, 255, 0.08) 1px, transparent 2px, transparent 20px),
        radial-gradient(circle at 50% 50%, var(--realdark-banner-color), transparent 70%);
    background-size: 100% 100%;
    opacity: 0.9 !important;
    /* High visibility */
    filter: contrast(1.2) brightness(1.2);
    /* Boost contrast */
    mix-blend-mode: screen;
    /* Safer blending */
    z-index: 10 !important;
    /* Bring to FRONT */
}

/* STORM (Now: Electric Arcs / Lightning) */
:root[data-realdark-atmosphere="storm"] .window-app.realdark-theme-window .window-content::before {
    /* Sharp, sparse electrical arcs using the Veins technique but "hotter" */
    background-image:
        repeating-linear-gradient(60deg, transparent, transparent 100px, rgba(255, 255, 255, 0.6) 100.5px, transparent 101px),
        repeating-linear-gradient(-60deg, transparent, transparent 120px, rgba(255, 255, 255, 0.5) 120.5px, transparent 121px),
        linear-gradient(to bottom, var(--realdark-banner-color), transparent);
    background-size: 100% 100%;
    filter: brightness(1.5) contrast(1.2);
    opacity: 0.8 !important;
    mix-blend-mode: screen;
    z-index: 10 !important;
    /* Bring to FRONT */
    /* animation: realdark-storm-flash 3s infinite steps(5); */
    /* erratic flashing */
}

/* ABYSS (Global) */
:root[data-realdark-atmosphere="abyss"] .window-app.realdark-theme-window .window-content::before {
    background-image: radial-gradient(circle at center, transparent 30%, black 100%);
    box-shadow: inset 0 0 150px black;
    opacity: 1;
    mix-blend-mode: multiply;
}

/* Remove old animations or keep if useful */
@keyframes realdark-fog-pulse {
    0% {
        background-position: 0% 50%;
        opacity: 0.5;
    }

    100% {
        background-position: 10% 40%;
        opacity: 0.7;
    }
}

/* New Animation: Lightning Flicker */
@keyframes realdark-storm-flash {

    0%,
    100% {
        opacity: 0.6;
        filter: brightness(1.5);
    }

    3% {
        opacity: 0.9;
        filter: brightness(3) blur(1px);
    }

    /* FLASH */
    6% {
        opacity: 0.6;
        filter: brightness(1.5);
    }

    40% {
        opacity: 0.5;
    }

    42% {
        opacity: 0.8;
        filter: brightness(2);
    }

    /* Mini flash */
    44% {
        opacity: 0.5;
    }
}

/* 1. Unset forced black background so custom colors shine through */
:root[data-realdark-atmosphere]:not([data-realdark-atmosphere='none']) .window-app.realdark-theme-window .window-content,
:root[data-realdark-atmosphere]:not([data-realdark-atmosphere='none']) .window-app.realdark-theme-window form {
    background-color: var(--realdark-sheet-bg) !important;
}

/* 2. Fix Opaque Gradients */

/* VEINS: Make fading transparent instead of black */
:root[data-realdark-atmosphere='veins'] .window-app.realdark-theme-window .window-content {
    background-image:
        repeating-linear-gradient(45deg, transparent, transparent 10px, var(--realdark-banner-color) 10px, rgba(0, 0, 0, 0) 20px),
        radial-gradient(circle at center, transparent 0%, rgba(0, 0, 0, 0.8) 100%) !important;
    background-blend-mode: normal !important;
}

/* STORM: Make fading transparent */
:root[data-realdark-atmosphere='storm'] .window-app.realdark-theme-window .window-content {
    background-image:
        linear-gradient(to bottom, rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.9) 80%),
        linear-gradient(to right, transparent 0%, var(--realdark-banner-color) 50%, transparent 100%) !important;
    background-blend-mode: overlay !important;
}

/* ABYSS: Make center transparent */
:root[data-realdark-atmosphere='abyss'] .window-app.realdark-theme-window .window-content {
    background-image: radial-gradient(circle at center, transparent 0%, var(--realdark-banner-color) 150%) !important;
}


/* End of Unified Atmosphere System */

/* ======================================================================== */
/* 6.5 PROTECTED SYSTEM ICONS                                               */
/* ======================================================================== */

/* Protect Invested Icon (Gem) - VISIBILITY FIX */
html body .window-app.realdark-theme-window a.invested,
html body .window-app.realdark-theme-window a.invested i,
html body .window-app.realdark-theme-window .invested,
html body .window-app.realdark-theme-window .invested i {
    background: transparent !important;
    background-color: transparent !important;
    background-image: none !important;
    border: none !important;
    box-shadow: none !important;
    opacity: 1 !important;
    padding: 0 !important;
    margin: 0 !important;

    /* Inactive State: Light Grey (Visible on Dark) */
    color: #666 !important;
    text-shadow: none !important;
    transition: color 0.2s ease;
}

html body .window-app.realdark-theme-window a.invested:hover,
html body .window-app.realdark-theme-window a.invested:hover i {
    color: #fff !important;
}

/* Active State: Theme Gold */
html body .window-app.realdark-theme-window a.invested.active,
html body .window-app.realdark-theme-window a.invested.active i {
    color: var(--realdark-gold) !important;
    text-shadow: 0 0 3px black !important;
}

/* ======================================================================== */
/* 7. INVENTORY & JOURNAL OVERRIDES                                         */
/* ======================================================================== */

/* Inventory Headers - Darken the brown */
.window-app.realdark-theme-active .inventory-list .header,
.window-app.realdark-theme-active .inventory-list .item-summary,
.window-app.realdark-theme-active .item-list .header {
    background: var(--realdark-sidebar-rgba-bottom) !important;
    color: var(--realdark-gold) !important;
    border-color: rgba(130, 130, 130, 0.2) !important;
    text-shadow: none !important;
    box-shadow: none !important;
}

/* Journal Sheets - Remove Parchment (Aggressive) */
.window-app.realdark-theme-active .journal-sheet,
.window-app.realdark-theme-active .journal-sheet .sheet-body,
.window-app.realdark-theme-active .journal-sheet .journal-entry-page,
/* ======================================================================== */
/* ANTI-FLASH: PREEMPTIVE STYLING (Scoped to Active Theme Only)             */
/* ======================================================================== */
/* 
   CHANGED: Scoped to .realdark-theme-window to preventing persisting on disabled sheets.
   Note: This may slightly reduce anti-flash effectiveness on first load before JS attaches the class,
   but it is necessary for the "Disable" feature to function correctly.
*/
html .realdark-theme-window.journal-sheet,
html .realdark-theme-window.journal-sheet .window-content,
html .realdark-theme-window.journal-sheet .sheet-body,
html .realdark-theme-window.journal-sheet article,
html .realdark-theme-window.journal-sheet .journal-entry-page,
html .realdark-theme-window.journal-sheet .journal-entry-content {
    background: transparent !important;
    background-image: none !important;
    background-color: transparent !important;
}

/* Kill the parchment image specifically and globally within journals immediately */
html .realdark-theme-window.journal-sheet [src*='parchment.webp'],
html .realdark-theme-window.journal-sheet [style*='parchment.webp'] {
    background-image: none !important;
    display: none !important;
}

/* FORCE BACKGROUND ON ALL LAYERS TO ENSURE VISIBILITY */
html body .realdark-theme-window.journal-sheet,
html body .realdark-theme-window.journal-sheet .window-content,
html body .realdark-theme-window.journal-sheet .sheet-body,
html body .realdark-theme-window.journal-sheet .journal-entry-page {
    background: var(--realdark-sheet-bg) !important;
    background-image: none !important;
    /* ensure no parchment */
}

/* Original Rules */
.window-app.realdark-theme-active .journal-sheet .journal-entry-content,
.window-app.realdark-theme-active .journal-sheet .editor-content,
.window-app.realdark-theme-active .journal-sheet article {
    background: transparent !important;
    background-image: none !important;
    background-color: transparent !important;
    color: var(--realdark-text-light) !important;
    border: none !important;
    box-shadow: none !important;
}

/* ======================================================================== */
/* NUCLEAR CHARACTER SHEET ANTI-FLASH (Scoped)                              */
/* ======================================================================== */

/* Force immediate dark background on character sheets */
html body .realdark-theme-window.pf2e.sheet.character .window-content,
html body .realdark-theme-window.actor.sheet.character .window-content,
html body .realdark-theme-window.pf2e.sheet.character .sheet-body,
html body .realdark-theme-window.actor.sheet.character .sheet-body {
    background-color: var(--realdark-sheet-bg) !important;
    background-image:
        radial-gradient(circle at center, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.1) 60%, rgba(0, 0, 0, 0.6) 100%),
        var(--realdark-bg-url) !important;
    background-repeat: no-repeat, repeat;
    background-size: cover, var(--realdark-bg-size, auto) !important;
    background-position: center !important;
    background-blend-mode: normal !important;
}

/* Kill specific assets immediately */
html body .realdark-theme-window.pf2e.sheet.character [src*='blue_sidebar_top.webp'],
html body .realdark-theme-window.actor.sheet.character [src*='blue_sidebar_top.webp'],
html body .realdark-theme-window.pf2e.sheet.character [src*='blue_sidebar_bottom.webp'],
html body .realdark-theme-window.actor.sheet.character [src*='blue_sidebar_bottom.webp'],
html body .realdark-theme-window.pf2e.sheet.character [src*='banner-bg.webp'],
html body .realdark-theme-window.actor.sheet.character [src*='banner-bg.webp'],
html body .realdark-theme-window.pf2e.sheet.character [src*='banner-bg2.webp'],
html body .realdark-theme-window.actor.sheet.character [src*='banner-bg2.webp'],
html body .realdark-theme-window.pf2e.sheet.character [src*='background.webp'],
html body .realdark-theme-window.actor.sheet.character [src*='background.webp'],
html body .realdark-theme-window.pf2e.sheet.character [src*='parchment.webp'],
html body .realdark-theme-window.actor.sheet.character [src*='parchment.webp'],
html body .realdark-theme-window.pf2e.sheet.character [src*='red_sidebar'],
html body .realdark-theme-window.actor.sheet.character [src*='red_sidebar'] {
    display: none !important;
    background-image: none !important;
    visibility: hidden !important;
    width: 0 !important;
    height: 0 !important;
}

/* Force specific header/bg fixes */
.window-app.realdark-theme-active .journal-header {
    background: rgba(0, 0, 0, 0.5) !important;
    border-bottom: 1px solid rgba(130, 130, 130, 0.2) !important;
}

/* Fix Journal Text Rendering */
.window-app.realdark-theme-active .journal-entry-content p,
.window-app.realdark-theme-active .journal-entry-content h1,
.window-app.realdark-theme-active .journal-entry-content h2,
.window-app.realdark-theme-active .journal-entry-content h3,
.window-app.realdark-theme-active .journal-entry-content span,
.window-app.realdark-theme-active .journal-entry-content li {
    color: var(--realdark-text-light) !important;
}

/* Specific fix for "light" styled journals if PF2e forces class */
.window-app.realdark-theme-window .journal-entry-page.light {
    filter: invert(0.9) hue-rotate(180deg) !important;
    background: #111 !important;
}

/* Re-invert images so they look normal */
.window-app.realdark-theme-window .journal-entry-page.light img {
    filter: invert(1) hue-rotate(180deg) !important;
}

/* HIDE LOGO IN JOURNAL SHEETS */
.window-app.realdark-theme-window.journal-sheet .realdark-logo {
    display: none !important;
}

/* ======================================================================== */
/* ======================================================================== */
/* 13. NAVIGATION & LOGO FIXES                                              */
/* ======================================================================== */

/* Force hide original logo container if it exists (prevents gap) */
/* Force hide original logo container if it exists (prevents gap) - HIGH SPECIFICITY */
html body .window-app.realdark-theme-window .sidebar .logo:not(.realdark-logo),
html body .window-app.realdark-theme-window .sidebar div.logo:not(.realdark-logo),
.window-app.realdark-theme-window .sidebar .logo:not(.realdark-logo) {
    display: none !important;
    height: 0 !important;
    min-height: 0 !important;
    max-height: 0 !important;
    margin: 0 !important;
    padding: 0 !important;
    visibility: hidden !important;
    opacity: 0 !important;
    position: absolute !important;
    top: -9999px !important;
    pointer-events: none !important;
}

/* Ensure our custom logo IS visible */
html body .window-app.realdark-theme-window .sidebar .realdark-logo,
.window-app.realdark-theme-window .sidebar .realdark-logo {
    display: block !important;
    visibility: visible !important;
    height: auto !important;
    min-height: auto !important;
    max-height: none !important;
    position: relative !important;
    top: auto !important;
    opacity: 1 !important;
}

/* Fix Navigation Line - Tab Style Overlap (Restored) */
.window-app.realdark-theme-window .sheet-navigation {
    border-bottom: 1px solid var(--realdark-gold-dim) !important;
    margin-bottom: 5px !important;
    padding-bottom: 0 !important;
    position: relative;
    z-index: 1;
}

.window-app.realdark-theme-window .sheet-navigation .item {
    border-bottom: 3px solid transparent !important;
    margin-bottom: -2px !important;
    /* Overlap the container border */
    position: relative;
    z-index: 2;
    /* Sit on top */
    padding-bottom: 5px !important;
}

.window-app.realdark-theme-window .sheet-navigation .item.active {
    border-bottom: 3px solid var(--realdark-gold) !important;
    color: var(--realdark-gold) !important;
    background: transparent !important;
}

/* ======================================================================== */
/* 14. GLOBAL BORDER SOFTENING (The Final Layer)                            */
/* ======================================================================== */

/* Soften Sidebar Inputs & Buttons */
html body .window-app.realdark-theme-window .crb-style aside input,
html body .window-app.realdark-theme-window .crb-style aside button,
html body .window-app.realdark-theme-window .crb-style aside select,
html body .window-app.realdark-theme-window .crb-style aside textarea,
html body .window-app.realdark-theme-window .sidebar input,
html body .window-app.realdark-theme-window .sidebar button {
    background-color: rgba(0, 0, 0, 0.5) !important;
    border: 1px solid rgba(130, 130, 130, 0.3) !important;
    /* Soft border */
    box-shadow: none !important;
    color: var(--realdark-text-light) !important;
    transition: border-color 0.2s ease;
}

html body .window-app.realdark-theme-window .crb-style aside input:hover,
html body .window-app.realdark-theme-window .crb-style aside button:hover,
html body .window-app.realdark-theme-window .crb-style aside select:hover,
html body .window-app.realdark-theme-window .crb-style aside textarea:hover,
html body .window-app.realdark-theme-window .sidebar input:hover,
html body .window-app.realdark-theme-window .sidebar button:hover {
    border: 1px solid rgba(255, 255, 255, 0.3) !important;
    /* Glow on hover */
}

/* Soften Window Frame & Header */
.window-app.realdark-theme-window {
    border: 1px solid rgba(130, 130, 130, 0.3) !important;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.8) !important;
}

.window-app.realdark-theme-window .sheet-header {
    border-bottom: 1px solid rgba(130, 130, 130, 0.2) !important;
}

/* Soften Chat Cards */
body.realdark-theme-active .chat-message {
    border: 1px solid rgba(130, 130, 130, 0.2) !important;
    /* Soft border */
    box-shadow: 0 0 5px #000 !important;
}

/* Fix Item Summary Background (Inventory Dropdowns) */
html body .window-app.realdark-theme-window .item-summary {
    background-color: rgba(0, 0, 0, 0.5) !important;
    color: var(--realdark-text-light) !important;
    border: 1px solid rgba(130, 130, 130, 0.2) !important;
    padding: 5px !important;
    border-radius: 4px !important;
}

/* ======================================================================== */
/* 14. TAG STYLING OVERRIDES (Language, Traits, Etc)                        */
/* ======================================================================== */
/* Force dark background for language fields and other tags */
html body .sheet.actor li.tag,
html body .sheet.actor span.tag,
html body .sheet.actor div.tag,
html body .sheet.actor .tags .tag,
html body .sheet.actor .subsection.languages ul li,
html body .sheet.actor .trait {
    background: rgba(0, 0, 0, 0.8) !important;
    background-color: rgba(0, 0, 0, 0.8) !important;
    background-image: none !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    color: var(--realdark-text-light) !important;
    box-shadow: none !important;
    text-shadow: none !important;
}

html body .sheet.actor li.tag span,
html body .sheet.actor .tag span {
    color: var(--realdark-text-light) !important;
    background: transparent !important;
}

/* Specific rarity/trait colors override */
html body .sheet.actor .tag.common,
html body .sheet.actor .tag.uncommon,
html body .sheet.actor .tag.rare,
html body .sheet.actor .tag.unique,
html body .sheet.actor .tag.secondary,
html body .sheet.actor .tag.nephilim,
html body .sheet.actor .tag.feenling {
    background-color: rgba(0, 0, 0, 0.8) !important;
}